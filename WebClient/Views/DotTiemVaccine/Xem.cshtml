@using WebClient.Core.Models;
@model WebClient.Core.ViewModels.DotTiem_VaccineVM
@{
    ViewData["Title"] = "Danh sách tiêm vaccine";
    AccountInfo account = this.ViewBag.Account;
}

<section class="content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12">
                <div class="card card-default">
                    <div class="card-header">
                        <h3 class="card-title">Đợt tiêm chủng</h3>
                    </div>
                    <div class="card-body">
                        <div class="form-group row">
                            <label for="inputPermission" class="col-sm-2 col-form-label">Mã đợt tiêm:</label>
                            <div class="col-sm-4">
                                @Html.TextBoxFor(Model => Model.Ma_DotTiem, new { @class = "form-control", disabled = true })
                            </div>
                            <label for="inputPermission" class="col-sm-2 col-form-label">Tên kế hoạch:</label>
                            <div class="col-sm-4">
                                @Html.TextBoxFor(Model => Model.Ten_KeHoach, new { @class = "form-control", disabled = true })
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="inputPermission" class="col-sm-2 col-form-label">Đơn vị:</label>
                            <div class="col-sm-4">
                                @Html.TextBoxFor(Model => Model.Ten_DonVi, new { @class = "form-control", disabled = true })
                            </div>
                            <label for="inputPermission" class="col-sm-2 col-form-label">Trạng thái:</label>
                            <div class="col-sm-4">
                                @{ if (Model.Trang_Thai == 1)
                                    {
                                        <span class="badge badge-success" style="font-size:13px">Đang mở đăng ký</span>
                                    }
                                    else
                                    {
                                        <span class="badge badge-danger" style="font-size:13px">Kết thúc đăng ký</span>
                                    }
                                }
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="inputPermission" class="col-sm-2 col-form-label">Ngày bắt đầu tiêm:</label>
                            <div class="col-sm-4">
                                @Html.TextBoxFor(Model => Model.NgayTiem_BatDau, "{0:dd/MM/yyyy}", new { @class = "form-control", disabled = true })
                            </div>
                            <label for="inputPermission" class="col-sm-2 col-form-label">Ngày kết thúc tiêm:</label>
                            <div class="col-sm-4">
                                @Html.TextBoxFor(Model => Model.NgayTiem_KetThuc, "{0:dd/MM/yyyy}", new { @class = "form-control", disabled = true })
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="inputPermission" class="col-sm-2 col-form-label">Số lượng đăng ký:</label>
                            <div class="col-sm-4">
                                @Html.TextBoxFor(Model => Model.SoLuong_DangKy, new { @class = "form-control", disabled = true })
                            </div>
                            <label for="inputPermission" class="col-sm-2 col-form-label">Số lượng đã tiêm:</label>
                            <div class="col-sm-4">
                                @Html.TextBoxFor(Model => Model.SoLuong_DaTiem, new { @class = "form-control", disabled = true })
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="inputPermission" class="col-sm-2 col-form-label">Ghi chú:</label>
                            <div class="col-sm-10">
                                @Html.TextAreaFor(Model => Model.Ghi_Chu, new { @class = "form-control", disabled = true })
                            </div>
                        </div>
                    </div>
                    @{
                        if (Model.Id_Cha == 0 && Model.Trang_Thai == 1)
                        {
                            <div class="card-footer">
                                <button id="btn-chotdanhsach" class="float-right btn btn-primary" type="button" style="margin-right: 15px;">
                                    <i class="fa fa-check-circle" aria-hidden="true"></i>
                                    Chốt danh sách
                                </button>
                            </div>
                        }
                    }
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-12">
                <div class="card card-default">
                    <div class="card-header">
                        <h3 class="card-title">Danh sách đăng ký tiêm</h3>
                        <div class="card-tools">
                            @{
                                if (Model.Trang_Thai == 0)
                                {
                                    <button type="button" class="btn btn-sm btn-primary float-left" data-toggle="modal" data-target="#modal-import-excel" style="margin-right: 10px;">
                                        <i class="fa fa-file-excel"></i>
                                        Nhập kết quả tiêm
                                    </button>
                                }
                            }
                            <button id="btn-export" class="btn btn-sm btn-success">
                                <i class="far fa-file-excel"></i>
                                Xuất file Excel
                            </button>
                            <button type="button" class="btn btn-tool" data-card-widget="collapse" title="Collapse">
                                <i class="fas fa-minus"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="dt-bootstrap4">
                            <table id="tbDoiTuongDangKy" class="table table-bordered table-hover dataTable dtr-inline" role="grid" aria-describedby="tbEmployee_info">
                                <thead>
                                    <tr>
                                        <th>STT</th>
                                        <th>Phường/Xã</th>
                                        <th>Họ tên</th>
                                        <th>Ngày sinh</th>
                                        <th>Giới tính</th>
                                        <th>SĐT</th>
                                        <th>Địa chỉ</th>
                                        <th>CMT/CCCD</th>
                                        <th>Trạng thái</th>
                                        <th>Tình trạng tiêm chủng</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @{ int index = 1;}
                                    @foreach (var doiTuong in Model.DsDoiTuongDangKy)
                                    {
                                        <tr>
                                            <td>@index</td>
                                            <td>@doiTuong.Ten_PhuongXa</td>
                                            <td>@doiTuong.Ho_Ten</td>
                                            <td>@doiTuong.Nam_Sinh</td>
                                            <td>@doiTuong.Ten_GioiTinh</td>
                                            <td>@doiTuong.So_DienThoai</td>
                                            <td>@doiTuong.DiaChi_HienTai</td>
                                            <td>@doiTuong.CMND</td>
                                            <td>
                                                @{
                                                    switch (doiTuong.Trang_Thai)
                                                    {
                                                        case 0:
                                                            <span class="badge badge-danger" style="font-size:13px">Chưa tiêm</span>;
                                                            break;
                                                        case 1:
                                                            <span class="badge badge-success" style="font-size:13px">Đã tiêm</span>;
                                                            break;
                                                        default:
                                                            <span class="badge badge-secondary" style="font-size:13px">Không xác định</span>;
                                                            break;
                                                    }
                                                }
                                            </td>
                                            <td>
                                                @{
                                                    switch (doiTuong.TinhTrang_TiemChung)
                                                    {
                                                        case 0:
                                                            <span class="badge badge-danger" style="font-size:13px">Chưa tiêm</span>;
                                                            break;
                                                        case 1:
                                                            <span class="badge badge-warning" style="font-size:13px">Đã tiêm mũi 1</span>;
                                                            break;
                                                        case 2:
                                                            <span class="badge badge-success" style="font-size:13px">Đã tiêm mũi 2</span>;
                                                            break;
                                                        default:
                                                            <span class="badge badge-secondary" style="font-size:13px">Không xác định</span>;
                                                            break;
                                                    }
                                                }
                                            </td>
                                        </tr>
                                        index++;
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- /.row -->

        <form id="form-export" action="/dottiemvaccine/ExportDsDangKyTiem" method="post" style="display: none">
        </form>
        <form id="form-chotdanhsach" action="/dottiemvaccine/ChotDanhSachDotTiem" method="post" style="display: none !important">
            <input name="Id" hidden value="@Model.Id_DotTiem" />
        </form>
    </div>

    <div class="modal fade" id="modal-import-excel">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">NHẬP KẾT QUẢ TIÊM VACCINE</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    @using (Html.BeginForm("NhapKetQuaTiem", "DotTiemVaccine", FormMethod.Post, new { enctype = "multipart/form-data", onsubmit = "return myFunction()" }))
                    {
                        @Html.AntiForgeryToken()
                        <div class="">
                            <input type="hidden" name="id_DotTiem" id="idDotTiem" value="@Model.Id_DotTiem" />
                            <div class="form-group row">
                                <label for="inputPermission" class="col-sm-2 col-form-label">File kết quả:</label>
                                <div class="col-sm-10">
                                    <input type="file" id="file" name="file" class="form-control" required />
                                </div>
                            </div>
                        </div>
                        <!-- /.box-body -->
                        <div class="box-footer">
                            <button type="button" class="btn btn-default float-left" data-dismiss="modal">Đóng</button>
                            <input type="submit" value="Lưu" id="btnSubmit" class="btn btn-primary float-right" />
                        </div>
                        <!-- /.box-footer -->
                    }
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>
</section>

@section Scripts{
    <script type="text/javascript">
         $(function () {
             $("#btn-export").click(function () {
                var $form = $("#form-export");
                        $form.empty();
                        $form.append("<input name='id' value='" + @Model.Id_DotTiem + "' />");
                        $form.submit();
             });

             $("#btn-chotdanhsach").click(function () {
                 modalHelper.showModal({
                     title: "Chốt danh sách tiêm vaccine",
                     body: "Bạn có thực sự muốn <strong>chốt</strong> danh sách tiêm vaccine này không.",
                     buttons: {
                         submit: "Đồng ý",
                         close: "Đóng"
                     },
                     submit: function () {
                         showLoading();
                         var $form = $("#form-chotdanhsach");
                         $form.submit();
                     }
                 })
                 
             });
        });
        // datatable
        $('#tbDoiTuongDangKy').DataTable({
            'paging': true,
            "responsive": true,
            'lengthChange': true,
            'searching': false,
            'ordering': false,
            'info': true,
            'autoWidth': false,
            "oLanguage": DataTable.language,
        });
    </script>
}
